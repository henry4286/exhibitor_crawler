# å±•ä¼šçˆ¬è™«ç³»ç»Ÿ - å®Œæ•´è¯´æ˜æ–‡æ¡£

> ç‰ˆæœ¬: v3.2  
> æœ€åæ›´æ–°: 2025-12-09

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
3. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
4. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
5. [é…ç½®æµ‹è¯•](#é…ç½®æµ‹è¯•)
6. [æ—¥å¿—ç®¡ç†](#æ—¥å¿—ç®¡ç†)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç³»ç»Ÿæ¦‚è¿°

### åŠŸèƒ½ç®€ä»‹

å±•ä¼šçˆ¬è™«ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¸“ä¸šçš„å±•ä¼šæ•°æ®é‡‡é›†å·¥å…·ï¼Œæ”¯æŒä»å„ç±»å±•ä¼šç½‘ç«™APIè‡ªåŠ¨æŠ“å–å‚å±•å•†ä¿¡æ¯å’Œè”ç³»äººæ•°æ®ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **åŒæ¨¡å¼æ”¯æŒ**: å•æ¬¡è¯·æ±‚å’ŒäºŒæ¬¡è¯·æ±‚ä¸¤ç§æ¨¡å¼
- âœ… **è‡ªåŠ¨é‡è¯•**: å†…ç½®æ™ºèƒ½é‡è¯•æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®è·å–æˆåŠŸ
- âœ… **å¤šçº¿ç¨‹å¹¶å‘**: æé«˜æ•°æ®æŠ“å–æ•ˆç‡
- âœ… **é…ç½®åŒ–ç®¡ç†**: Excelé…ç½®æ–‡ä»¶ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
- âœ… **å®Œæ•´æ—¥å¿—**: è¯¦ç»†çš„è¯·æ±‚æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—
- âœ… **é…ç½®æµ‹è¯•**: ç‹¬ç«‹çš„æµ‹è¯•å·¥å…·éªŒè¯é…ç½®æ­£ç¡®æ€§

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. ä¸¤ç§çˆ¬å–æ¨¡å¼

#### ğŸ”¹ å•æ¬¡è¯·æ±‚æ¨¡å¼ (Single Mode)

**é€‚ç”¨åœºæ™¯**: APIä¸€æ¬¡æ€§è¿”å›å®Œæ•´æ•°æ®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åˆ—è¡¨APIè¯·æ±‚    â”‚
â”‚  (åŒ…å«å®Œæ•´æ•°æ®)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è§£ææ•°æ®       â”‚
â”‚ (å…¬å¸+è”ç³»äºº)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¿å­˜åˆ°Excel     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®ç¤ºä¾‹**:
```
request_mode = "single"
```

#### ğŸ”¹ äºŒæ¬¡è¯·æ±‚æ¨¡å¼ (Double Mode)

**é€‚ç”¨åœºæ™¯**: éœ€è¦å…ˆè·å–åˆ—è¡¨ï¼Œå†è·å–è¯¦æƒ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åˆ—è¡¨APIè¯·æ±‚    â”‚
â”‚  (ä»…åŸºæœ¬ä¿¡æ¯)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è·å–å…¬å¸IDåˆ—è¡¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯¦æƒ…APIè¯·æ±‚     â”‚ â”€â”€â”€â–¶ â”‚  è¯¦æƒ…APIè¯·æ±‚     â”‚
â”‚  (å…¬å¸1è”ç³»äºº)   â”‚      â”‚  (å…¬å¸2è”ç³»äºº)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  åˆå¹¶å®Œæ•´æ•°æ®    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  ä¿å­˜åˆ°Excel     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®ç¤ºä¾‹**:
```
request_mode = "double"
url_detail = "https://api.example.com/contact/#company_id"
```

### 2. æ ¸å¿ƒç±»è¯´æ˜

#### CompanyCrawler (å•æ¬¡è¯·æ±‚çˆ¬è™«)
- **èŒè´£**: å¤„ç†å•æ¬¡è¯·æ±‚æ¨¡å¼
- **åŠŸèƒ½**: 
  - ç¿»é¡µçˆ¬å–åˆ—è¡¨æ•°æ®
  - è§£æå­—æ®µæ˜ å°„
  - ä¿å­˜åˆ°Excel
- **ç‰¹ç‚¹**: ç‹¬ç«‹å®Œæˆæ‰€æœ‰å·¥ä½œ

#### DoubleFetchCrawler (äºŒæ¬¡è¯·æ±‚çˆ¬è™«)
- **èŒè´£**: åè°ƒäºŒæ¬¡è¯·æ±‚æµç¨‹
- **åŠŸèƒ½**:
  - è·å–å…¬å¸åˆ—è¡¨
  - è°ƒç”¨DetailFetcherè·å–è¯¦æƒ…
  - åˆå¹¶æ•°æ®å¹¶ä¿å­˜
- **ç‰¹ç‚¹**: é€é¡µå¤„ç†ï¼Œé¿å…æ•°æ®ä¸¢å¤±

#### DetailFetcher (è¯¦æƒ…è·å–å·¥å…·)
- **èŒè´£**: æ‰§è¡Œè¯¦æƒ…/è”ç³»äººè¯·æ±‚
- **åŠŸèƒ½**:
  - `fetch_company_detail()`: è·å–å…¬å¸è¯¦æƒ…
  - `fetch_company_contacts()`: è·å–è”ç³»äºº
  - `fetch_batch_details()`: æ‰¹é‡å¹¶å‘è·å–
- **ç‰¹ç‚¹**: å¯å¤ç”¨çš„å·¥å…·ç»„ä»¶

### 3. ç±»ä¹‹é—´çš„å…³ç³»

```
run_crawler.py (UnifiedCrawler)
    â”‚
    â”œâ”€â”€ request_mode = "single"
    â”‚   â””â”€â–¶ CompanyCrawler (ç‹¬ç«‹å®Œæˆ)
    â”‚
    â””â”€â”€ request_mode = "double"
        â””â”€â–¶ DoubleFetchCrawler (åè°ƒè€…)
            â””â”€â–¶ DetailFetcher (æ‰§è¡Œè€…)
```

---

## ç³»ç»Ÿæ¶æ„

### ç›®å½•ç»“æ„

```
exhibitor_crawler/
â”œâ”€â”€ run_crawler.py              # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ test_config.py              # é…ç½®æµ‹è¯•å·¥å…·
â”œâ”€â”€ unified_logger.py           # ç»Ÿä¸€æ—¥å¿—æ¨¡å—
â”œâ”€â”€ config.xlsx                 # é…ç½®æ–‡ä»¶
â”œâ”€â”€ crawler_lib/                # çˆ¬è™«æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ crawler.py              # CompanyCrawler & DoubleFetchCrawler
â”‚   â”œâ”€â”€ detail_fetcher.py       # DetailFetcher
â”‚   â”œâ”€â”€ config_manager.py       # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ http_client.py          # HTTPå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ data_parser.py          # æ•°æ®è§£æ
â”‚   â”œâ”€â”€ excel_exporter.py       # Excelå¯¼å‡º
â”‚   â””â”€â”€ utils.py                # å·¥å…·å‡½æ•°
â”œâ”€â”€ logs/                       # æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ request_history.log     # è¯·æ±‚æ—¥å¿—
â”‚   â””â”€â”€ app_error.log           # é”™è¯¯æ—¥å¿—
â””â”€â”€ ExhibitorList/              # æ•°æ®è¾“å‡ºç›®å½•
    â””â”€â”€ {å±•ä¼šä»£ç }.xlsx         # çˆ¬å–ç»“æœ
```

### æ¨¡å—ä¾èµ–å…³ç³»

```
run_crawler.py
    â†“
crawler_lib.crawler (CompanyCrawler/DoubleFetchCrawler)
    â†“
â”œâ”€â”€ crawler_lib.config_manager (ConfigManager)
â”œâ”€â”€ crawler_lib.http_client (HttpClient)
â”œâ”€â”€ crawler_lib.data_parser (DataParser)
â”œâ”€â”€ crawler_lib.excel_exporter (ExcelExporter)
â”œâ”€â”€ crawler_lib.detail_fetcher (DetailFetcher)
â””â”€â”€ unified_logger (æ—¥å¿—ç³»ç»Ÿ)
```

---

## ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

#### 1. ç¯å¢ƒè¦æ±‚

```bash
Python 3.8+
ä¾èµ–åŒ…: requests, openpyxl, pandas
```

#### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

#### 3. è¿è¡Œçˆ¬è™«

**åŸºæœ¬ç”¨æ³•**:
```bash
python run_crawler.py æ— äººæœºå±•
```

**æŒ‡å®šçº¿ç¨‹æ•°**:
```bash
python run_crawler.py æ— äººæœºå±• --workers 4
```

**ä»æŒ‡å®šé¡µå¼€å§‹**:
```bash
python run_crawler.py æ— äººæœºå±• --start-page 50
```

**ç»„åˆå‚æ•°**:
```bash
python run_crawler.py æ— äººæœºå±• --workers 4 --start-page 50
```

### å‘½ä»¤è¡Œå‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|------|------|--------|------|
| `exhibition_code` | å±•ä¼šä»£ç ï¼ˆå¿…å¡«ï¼‰ | - | `æ— äººæœºå±•` |
| `--workers N` | å¹¶å‘çº¿ç¨‹æ•° | 2 | `--workers 4` |
| `--start-page N` | èµ·å§‹é¡µç  | 1 | `--start-page 50` |

### é…ç½®æ–‡ä»¶ (config.xlsx)

#### å¿…å¡«å­—æ®µ

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `exhibition` | å±•ä¼šä»£ç  | `æ— äººæœºå±•` |
| `request_mode` | è¯·æ±‚æ¨¡å¼ | `single` / `double` |
| `url` | åˆ—è¡¨APIåœ°å€ | `https://api.example.com/list` |
| `request_method` | è¯·æ±‚æ–¹æ³• | `GET` / `POST` |
| `items_key` | æ•°æ®æå–è·¯å¾„ | `data.list` |
| `company_info_keys` | å­—æ®µæ˜ å°„ï¼ˆJSONï¼‰ | `{"Company":"name","Phone":"phone"}` |

#### äºŒæ¬¡è¯·æ±‚æ¨¡å¼é¢å¤–å­—æ®µ

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `url_detail` | è¯¦æƒ…APIåœ°å€ | `https://api.example.com/detail/#company_id` |
| `request_method_detail` | è¯¦æƒ…è¯·æ±‚æ–¹æ³• | `GET` / `POST` |
| `items_key_detail` | è¯¦æƒ…æ•°æ®è·¯å¾„ | `data.contacts` |
| `info_key` | è”ç³»äººå­—æ®µæ˜ å°„ | `{"Name":"contactName","Email":"email"}` |

#### å ä½ç¬¦è¯´æ˜

åœ¨URL/å‚æ•°ä¸­æ”¯æŒä»¥ä¸‹å ä½ç¬¦ï¼š

- `{page}`: å½“å‰é¡µç 
- `{skipCount}`: è·³è¿‡è®°å½•æ•° (page-1)*20
- `{pageSize}`: æ¯é¡µå¤§å° (é»˜è®¤20)
- `#company_id`: å…¬å¸ID (äºŒæ¬¡è¯·æ±‚)
- `#ä»»æ„å­—æ®µ`: ä»ç¬¬ä¸€æ¬¡è¯·æ±‚å“åº”ä¸­æå–çš„å­—æ®µå€¼

**ç¤ºä¾‹**:
```
url = "https://api.example.com/list?page={page}&size={pageSize}"
url_detail = "https://api.example.com/contact/#company_id"
params_detail = {"companyName": "#company_name"}
```

---

## é…ç½®æµ‹è¯•

### test_config.py å·¥å…·

åœ¨æ­£å¼è¿è¡Œçˆ¬è™«å‰ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨æµ‹è¯•å·¥å…·éªŒè¯é…ç½®ã€‚

### ä½¿ç”¨æ–¹æ³•

```bash
python test_config.py æ— äººæœºå±•
```

### æµ‹è¯•å†…å®¹

#### âœ… 1. åŸºæœ¬é…ç½®éªŒè¯
- å±•ä¼šä»£ç æ˜¯å¦å­˜åœ¨
- å¿…å¡«å­—æ®µæ˜¯å¦å®Œæ•´
- è¯·æ±‚æ¨¡å¼æ˜¯å¦æ­£ç¡®
- å­—æ®µæ˜ å°„æ ¼å¼æ˜¯å¦æ­£ç¡®

#### âœ… 2. APIè¿æ¥æµ‹è¯•
- åˆ—è¡¨APIæ˜¯å¦å¯è®¿é—®
- å“åº”çŠ¶æ€ç æ˜¯å¦æ­£å¸¸
- å“åº”æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®

#### âœ… 3. æ•°æ®æå–æµ‹è¯•
- items_keyè·¯å¾„æ˜¯å¦æ­£ç¡®
- èƒ½å¦æˆåŠŸæå–æ•°æ®åˆ—è¡¨
- æ•°æ®æ¡æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸ

#### âœ… 4. å­—æ®µæ˜ å°„æµ‹è¯•
- æ¯ä¸ªå­—æ®µè·¯å¾„æ˜¯å¦èƒ½æå–åˆ°å€¼
- å­—æ®µå€¼æ˜¯å¦ä¸ºç©º
- æ ‡è®°æˆåŠŸ/å¤±è´¥çš„å­—æ®µ

**è¾“å‡ºç¤ºä¾‹**:
```
âœ… Company â† data.name: æ·±åœ³æ— äººæœºç§‘æŠ€æœ‰é™å…¬å¸
âœ… Phone â† data.phone: 0755-12345678
âŒ Email â† data.email: (æœªæ‰¾åˆ°æˆ–ä¸ºç©º)

å­—æ®µæ˜ å°„ç»“æœ: 2/3 ä¸ªå­—æ®µæˆåŠŸæå–
âœ… å­—æ®µæ˜ å°„æˆåŠŸï¼è‡³å°‘èƒ½æå–åˆ°æœ‰æ•ˆæ•°æ®
```

#### âœ… 5. ç¿»é¡µåŠŸèƒ½æµ‹è¯•
- è¯·æ±‚ç¬¬1é¡µå’Œç¬¬2é¡µ
- æ¯”è¾ƒæ•°æ®æ˜¯å¦é‡å¤
- éªŒè¯ç¿»é¡µå‚æ•°é…ç½®

**æµ‹è¯•é€»è¾‘**:
```
- ç¬¬1é¡µæœ‰æ•°æ® + ç¬¬2é¡µæœ‰æ•°æ® + æ•°æ®ä¸é‡å¤ â†’ âœ… ç¿»é¡µæ­£å¸¸
- ç¬¬1é¡µæœ‰æ•°æ® + ç¬¬2é¡µæ— æ•°æ® + æœ‰ç¿»é¡µé…ç½® â†’ âš ï¸ å¯èƒ½æœ‰é—®é¢˜
- ç¬¬1é¡µæœ‰æ•°æ® + ç¬¬2é¡µæ— æ•°æ® + æ— ç¿»é¡µé…ç½® â†’ âœ… æ­£å¸¸ï¼ˆå•é¡µï¼‰
- ç¬¬1é¡µæ— æ•°æ® â†’ âŒ æµ‹è¯•å¤±è´¥
```

#### âœ… 6. äºŒæ¬¡è¯·æ±‚æµ‹è¯• (åŒæ¨¡å¼)
- è¯¦æƒ…APIæ˜¯å¦å¯è®¿é—®
- å ä½ç¬¦æ›¿æ¢æ˜¯å¦æ­£ç¡®
- è”ç³»äººå­—æ®µæ˜ å°„æ˜¯å¦æœ‰æ•ˆ
- æ•°æ®æ˜¯å¦å®Œæ•´

**è°ƒè¯•ä¿¡æ¯**:
```
ğŸ” è°ƒè¯•ä¿¡æ¯ - è¯¦æƒ…APIåŸå§‹å“åº”:
è¯·æ±‚è¯¦æƒ… - URL: https://api.example.com/contact/12345
items_key_detailè·¯å¾„: data.contacts
æå–æ•°æ®ç±»å‹: list
åˆ—è¡¨é•¿åº¦: 3
ç¬¬ä¸€é¡¹å­—æ®µ: ['name', 'phone', 'email', 'position']
```

### æµ‹è¯•ç»“æœè§£è¯»

#### æˆåŠŸç¤ºä¾‹
```
âœ… é…ç½®æµ‹è¯•å®Œæˆ - æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼

æµ‹è¯•ç»“æœ:
  - åŸºæœ¬é…ç½®: âœ… æ­£å¸¸
  - APIè¿æ¥: âœ… æ­£å¸¸
  - æ•°æ®æå–: âœ… æ­£å¸¸
  - å­—æ®µæ˜ å°„: âœ… æˆåŠŸ
  - ç¿»é¡µåŠŸèƒ½: âœ… æ­£å¸¸
  - è¯¦æƒ…è¯·æ±‚: âœ… æˆåŠŸ
```

#### å¤±è´¥ç¤ºä¾‹
```
âŒ é…ç½®æµ‹è¯•å®Œæˆ - éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼

æµ‹è¯•ç»“æœ:
  - åŸºæœ¬é…ç½®: âœ… æ­£å¸¸
  - APIè¿æ¥: âœ… æ­£å¸¸
  - æ•°æ®æå–: âœ… æ­£å¸¸
  - å­—æ®µæ˜ å°„: âŒ å¤±è´¥
  - ç¿»é¡µåŠŸèƒ½: âš ï¸  å¯èƒ½æœ‰é—®é¢˜
  - è¯¦æƒ…è¯·æ±‚: âŒ å¤±è´¥
```

---

## æ—¥å¿—ç®¡ç†

### æ—¥å¿—ç³»ç»Ÿæ¶æ„

ç³»ç»Ÿé‡‡ç”¨ç»Ÿä¸€çš„æ—¥å¿—ç®¡ç†æ¨¡å— `unified_logger.py`ï¼Œæä¾›ä¸‰å±‚æ—¥å¿—è¾“å‡ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        UnifiedLogger æ—¥å¿—ç³»ç»Ÿ        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. æ§åˆ¶å°æ—¥å¿— (Console)             â”‚
â”‚     - ç®€æ´è¾“å‡º                       â”‚
â”‚     - å®æ—¶è¿›åº¦                       â”‚
â”‚                                      â”‚
â”‚  2. è¯·æ±‚æ—¥å¿— (request_history.log)  â”‚
â”‚     - å®Œæ•´è¯·æ±‚å‚æ•°                   â”‚
â”‚     - å®Œæ•´å“åº”æ•°æ®                   â”‚
â”‚     - è‡ªåŠ¨è½®è½¬ (1MB * 5)             â”‚
â”‚                                      â”‚
â”‚  3. é”™è¯¯æ—¥å¿— (app_error.log)        â”‚
â”‚     - ç³»ç»Ÿé”™è¯¯                       â”‚
â”‚     - å¼‚å¸¸å †æ ˆ                       â”‚
â”‚     - è‡ªåŠ¨è½®è½¬ (5MB * 5)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ—¥å¿—æ–‡ä»¶

#### 1. è¯·æ±‚æ—¥å¿— (logs/request_history.log)

**ç”¨é€”**: è®°å½•æ‰€æœ‰HTTPè¯·æ±‚å’Œå“åº”

**æ ¼å¼**:
```
2025-12-09 14:00:00 - [POST] https://api.example.com/list
å‚æ•°: {
  "page": 1,
  "size": 20
}
è¯·æ±‚ä½“: {
  "keyword": "æ— äººæœº"
}
å“åº”ä½“: {
  "code": 0,
  "data": {
    "list": [...]
  }
}
--------------------------------------------------------------------------------
```

**é…ç½®**:
- æœ€å¤§æ–‡ä»¶å¤§å°: 1MB
- å¤‡ä»½æ–‡ä»¶æ•°: 5
- è‡ªåŠ¨è½®è½¬

#### 2. é”™è¯¯æ—¥å¿— (logs/app_error.log)

**ç”¨é€”**: è®°å½•ç³»ç»Ÿé”™è¯¯å’Œå¼‚å¸¸

**æ ¼å¼**:
```
2025-12-09 14:00:00 - ERROR - ç¬¬5é¡µæ•°æ®ä¸‹è½½å¤±è´¥ | å¼‚å¸¸: ConnectionError: è¿æ¥è¶…æ—¶
2025-12-09 14:01:00 - ERROR - çˆ¬å–è¿‡ç¨‹å‡ºé”™
Traceback (most recent call last):
  File "crawler.py", line 100, in crawl
    ...
```

**é…ç½®**:
- æœ€å¤§æ–‡ä»¶å¤§å°: 5MB
- å¤‡ä»½æ–‡ä»¶æ•°: 5
- è‡ªåŠ¨è½®è½¬

### æ—¥å¿—å‡½æ•°

#### åŸºç¡€æ—¥å¿—å‡½æ•°

```python
from unified_logger import (
    console,        # æ§åˆ¶å°è¾“å‡º
    log_info,       # ä¿¡æ¯æ—¥å¿—
    log_warning,    # è­¦å‘Šæ—¥å¿—
    log_error,      # é”™è¯¯æ—¥å¿—
    log_exception,  # å¼‚å¸¸æ—¥å¿—ï¼ˆå«å †æ ˆï¼‰
    log_request     # è¯·æ±‚æ—¥å¿—
)

# ä½¿ç”¨ç¤ºä¾‹
console("å¼€å§‹çˆ¬å–æ•°æ®...")
log_info("çˆ¬è™«å¯åŠ¨æˆåŠŸ")
log_warning("æ£€æµ‹åˆ°é‡å¤æ•°æ®")
log_error("APIè¯·æ±‚å¤±è´¥", exception=e)
log_exception("ç³»ç»Ÿå¼‚å¸¸")

log_request(
    url="https://api.example.com/data",
    method="POST",
    params={"page": 1},
    data={"keyword": "test"},
    response={"code": 0, "data": [...]}
)
```

#### çˆ¬è™«ä¸“ç”¨å‡½æ•°

```python
from unified_logger import (
    log_page_progress,      # é¡µé¢è¿›åº¦
    log_list_progress,      # åˆ—è¡¨è·å–è¿›åº¦
    log_contacts_saved      # è”ç³»äººä¿å­˜è¿›åº¦
)

# ä½¿ç”¨ç¤ºä¾‹
log_page_progress(1, 50)        # ğŸ“„ ç¬¬1é¡µå®Œæˆï¼Œè·å–åˆ°50æ¡æ•°æ®
log_list_progress(2, 30)        # ğŸ“„ ç¬¬2é¡µ - è·å–å…¬å¸åˆ—è¡¨ï¼š30ä¸ª
log_contacts_saved(2, 25)       # ğŸ’¾ ç¬¬2é¡µ - å·²ä¿å­˜25æ¡è”ç³»äºº
```

#### UIç›¸å…³å‡½æ•°

```python
from unified_logger import (
    log_config_error,       # é…ç½®é”™è¯¯
    log_file_operation      # æ–‡ä»¶æ“ä½œ
)

# ä½¿ç”¨ç¤ºä¾‹
log_config_error("config.xlsx", "æ–‡ä»¶ä¸å­˜åœ¨")
log_file_operation("ä¿å­˜æ–‡ä»¶", "data.xlsx", success=True)
log_file_operation("è¯»å–æ–‡ä»¶", "missing.xlsx", success=False, error="æ–‡ä»¶ä¸å­˜åœ¨")
```

### æ—¥å¿—çº§åˆ«

| çº§åˆ« | æ§åˆ¶å° | request_history.log | app_error.log |
|------|--------|---------------------|---------------|
| console() | âœ… | - | - |
| log_info() | âœ… | - | - |
| log_warning() | âœ… | - | âš ï¸ WARNING |
| log_error() | âœ… | - | âŒ ERROR |
| log_exception() | âœ… | - | âŒ ERROR (å«å †æ ˆ) |
| log_request() | - | âœ… DEBUG | - |

### æ—¥å¿—æœ€ä½³å®è·µ

#### âœ… æ¨èåšæ³•

```python
# 1. è®°å½•å…³é”®æ­¥éª¤è¿›åº¦
log_page_progress(page, count)

# 2. è®°å½•æ‰€æœ‰HTTPè¯·æ±‚
log_request(url, method, params, data, response)

# 3. è®°å½•é”™è¯¯ä½†ä¸ä¸­æ–­æ‰§è¡Œ
try:
    result = fetch_data()
except Exception as e:
    log_error("æ•°æ®è·å–å¤±è´¥", exception=e)
    # ç»§ç»­æ‰§è¡Œæˆ–ä½¿ç”¨é»˜è®¤å€¼

# 4. è®°å½•å¼‚å¸¸å¹¶ç»ˆæ­¢
try:
    critical_operation()
except Exception:
    log_exception("å…³é”®æ“ä½œå¤±è´¥")
    raise
```

#### âŒ é¿å…åšæ³•

```python
# ä¸è¦åœ¨å¾ªç¯ä¸­é¢‘ç¹è¾“å‡ºæ—¥å¿—
for i in range(10000):
    console(f"å¤„ç†ç¬¬{i}æ¡")  # âŒ ä¼šåˆ·å±

# ä¸è¦è®°å½•æ•æ„Ÿä¿¡æ¯
log_request(url, data={"password": "123456"})  # âŒ æ³„éœ²å¯†ç 

# ä¸è¦åœ¨æ—¥å¿—ä¸­åŒ…å«å¤§é‡æ•°æ®
log_error(f"é”™è¯¯æ•°æ®: {huge_data_list}")  # âŒ æ—¥å¿—æ–‡ä»¶è¿‡å¤§
```

### æ—¥å¿—ç»´æŠ¤

#### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æœ€æ–°çš„è¯·æ±‚æ—¥å¿—
tail -f logs/request_history.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f logs/app_error.log

# æœç´¢ç‰¹å®šå…³é”®è¯
grep "ERROR" logs/app_error.log
```

#### æ¸…ç†æ—¥å¿—

ç³»ç»Ÿä¼šè‡ªåŠ¨è½®è½¬æ—¥å¿—æ–‡ä»¶ï¼Œä½†å¦‚éœ€æ‰‹åŠ¨æ¸…ç†ï¼š

```bash
# Windows
del /Q logs\*.log

# Linux/Mac
rm -f logs/*.log
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•åˆ¤æ–­ä½¿ç”¨å“ªç§è¯·æ±‚æ¨¡å¼ï¼Ÿ

**A**: æŸ¥çœ‹APIçš„æ•°æ®ç»“æ„ï¼š

- **å•æ¬¡è¯·æ±‚æ¨¡å¼**: åˆ—è¡¨APIå°±åŒ…å«æ‰€æœ‰éœ€è¦çš„å­—æ®µ
  ```json
  {
    "data": {
      "list": [
        {"name": "å…¬å¸A", "phone": "123456", "email": "a@example.com"},
        {"name": "å…¬å¸B", "phone": "789012", "email": "b@example.com"}
      ]
    }
  }
  ```

- **äºŒæ¬¡è¯·æ±‚æ¨¡å¼**: åˆ—è¡¨APIåªæœ‰åŸºæœ¬ä¿¡æ¯ï¼Œéœ€è¦å†è¯·æ±‚è¯¦æƒ…
  ```json
  // åˆ—è¡¨API
  {
    "data": {
      "list": [
        {"id": 1, "name": "å…¬å¸A"},
        {"id": 2, "name": "å…¬å¸B"}
      ]
    }
  }
  
  // è¯¦æƒ…API (éœ€è¦ç”¨IDå†è¯·æ±‚)
  {
    "data": {
      "contacts": [
        {"name": "å¼ ä¸‰", "phone": "123456"}
      ]
    }
  }
  ```

### Q2: é…ç½®æµ‹è¯•å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: æ ¹æ®å¤±è´¥ç±»å‹æ’æŸ¥ï¼š

1. **APIè¿æ¥å¤±è´¥**
   - æ£€æŸ¥URLæ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - æ£€æŸ¥æ˜¯å¦éœ€è¦VPN

2. **æ•°æ®æå–å¤±è´¥**
   - æ£€æŸ¥items_keyè·¯å¾„æ˜¯å¦æ­£ç¡®
   - ä½¿ç”¨test_config.pyæŸ¥çœ‹åŸå§‹å“åº”
   - å¯¹æ¯”APIæ–‡æ¡£ç¡®è®¤æ•°æ®ç»“æ„

3. **å­—æ®µæ˜ å°„å¤±è´¥**
   - æŸ¥çœ‹test_config.pyçš„è°ƒè¯•è¾“å‡º
   - ç¡®è®¤å­—æ®µè·¯å¾„æ‹¼å†™æ­£ç¡®
   - æ³¨æ„å¤§å°å†™æ•æ„Ÿ

4. **ç¿»é¡µåŠŸèƒ½å¼‚å¸¸**
   - æ£€æŸ¥URL/params/dataä¸­æ˜¯å¦æœ‰{page}å ä½ç¬¦
   - éªŒè¯ç¬¬2é¡µç¡®å®æœ‰æ•°æ®
   - ç¡®è®¤ç¿»é¡µå‚æ•°åç§°æ­£ç¡®

### Q3: çˆ¬å–è¿‡ç¨‹ä¸­å‡ºç°429é”™è¯¯

**A**: è§¦å‘äº†APIé™æµï¼Œè§£å†³æ–¹æ³•ï¼š

```bash
# å‡å°‘å¹¶å‘çº¿ç¨‹æ•°
python run_crawler.py æ— äººæœºå±• --workers 1

# ä¿®æ”¹http_client.pyæ·»åŠ å»¶è¿Ÿ
time.sleep(1)  # æ¯æ¬¡è¯·æ±‚å»¶è¿Ÿ1ç§’
```

### Q4: æ•°æ®ä¸å®Œæ•´æ€ä¹ˆåŠï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. ä½¿ç”¨test_config.pyéªŒè¯å­—æ®µæ˜ å°„
2. æŸ¥çœ‹logs/request_history.logç¡®è®¤APIå“åº”
3. æ£€æŸ¥items_keyå’Œå­—æ®µè·¯å¾„æ˜¯å¦æ­£ç¡®
4. ç¡®è®¤APIæ•°æ®æœ¬èº«æ˜¯å¦å®Œæ•´

### Q5: å¦‚ä½•ä»ä¸­æ–­å¤„ç»§ç»­çˆ¬å–ï¼Ÿ

**A**: ä½¿ç”¨--start-pageå‚æ•°ï¼š

```bash
# ä»ç¬¬50é¡µç»§ç»­
python run_crawler.py æ— äººæœºå±• --start-page 50
```

### Q6: Excelæ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ

**A**: ä¿å­˜åœ¨ `ExhibitorList/{å±•ä¼šä»£ç }.xlsx`

```bash
# æŸ¥çœ‹ç»“æœæ–‡ä»¶
ls ExhibitorList/
# æˆ–
dir ExhibitorList\
```

### Q7: å¦‚ä½•è°ƒè¯•é…ç½®é—®é¢˜ï¼Ÿ

**A**: æŒ‰ä»¥ä¸‹æ­¥éª¤ï¼š

```bash
# 1. è¿è¡Œé…ç½®æµ‹è¯•
python test_config.py æ— äººæœºå±•

# 2. æŸ¥çœ‹è¯·æ±‚æ—¥å¿—
cat logs/request_history.log

# 3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
cat logs/app_error.log

# 4. æ£€æŸ¥åŸå§‹å“åº”æ•°æ®ç»“æ„
# test_config.pyä¼šæ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
```

### Q8: å¤šä¸ªå±•ä¼šåŒæ—¶çˆ¬å–ï¼Ÿ

**A**: ä¸æ”¯æŒã€‚å»ºè®®é€ä¸ªè¿è¡Œï¼š

```bash
python run_crawler.py å±•ä¼šA --workers 2
python run_crawler.py å±•ä¼šB --workers 2
python run_crawler.py å±•ä¼šC --workers 2
```

---

## é™„å½•

### A. é…ç½®ç¤ºä¾‹

#### å•æ¬¡è¯·æ±‚æ¨¡å¼å®Œæ•´é…ç½®

```json
{
  "exhibition": "æ— äººæœºå±•",
  "request_mode": "single",
  "url": "https://api.example.com/list?page={page}",
  "request_method": "GET",
  "items_key": "data.list",
  "company_info_keys": {
    "Company": "name",
    "Contact": "contact",
    "Phone": "phone",
    "Email": "email",
    "Address": "address"
  }
}
```

#### äºŒæ¬¡è¯·æ±‚æ¨¡å¼å®Œæ•´é…ç½®

```json
{
  "exhibition": "å†œäº§å“å±•",
  "request_mode": "double",
  "url": "https://api.example.com/companies",
  "request_method": "GET",
  "items_key": "data.companies",
  "company_info_keys": {
    "ID": "id",
    "Company": "name"
  },
  "url_detail": "https://api.example.com/contact/#company_id",
  "request_method_detail": "POST",
  "items_key_detail": "data.contacts",
  "info_key": {
    "Contact": "contactName",
    "Phone": "phone",
    "Email": "email",
    "Position": "position"
  }
}
```

### B. æ—¥å¿—ç¤ºä¾‹

#### è¯·æ±‚æ—¥å¿—ç¤ºä¾‹

```
2025-12-09 14:00:00 - [GET] https://api.example.com/list
å‚æ•°: {
  "page": 1,
  "size": 20
}
å“åº”ä½“: {
  "code": 0,
  "message": "success",
  "data": {
    "total": 500,
    "list": [
      {
        "id": 1,
        "name": "æ·±åœ³æ— äººæœºç§‘æŠ€",
        "phone": "0755-12345678"
      }
    ]
  }
}
--------------------------------------------------------------------------------
```

#### é”™è¯¯æ—¥å¿—ç¤ºä¾‹

```
2025-12-09 14:00:00 - ERROR - ç¬¬5é¡µæ•°æ®ä¸‹è½½å¤±è´¥ | å¼‚å¸¸: ConnectionError: HTTPSConnectionPool(host='api.example.com', port=443): Max retries exceeded
2025-12-09 14:01:00 - ERROR - çˆ¬å–è¿‡ç¨‹å‡ºé”™
Traceback (most recent call last):
  File "crawler.py", line 580, in crawl
    companies = self.crawl_page(page)
  File "crawler.py", line 425, in crawl_page
    response_data = self.http_client.send_request_with_retry(...)
ConnectionError: Connection timeout
```

### C. æŠ€æœ¯æ”¯æŒ

**é—®é¢˜åé¦ˆ**: è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯
- å±•ä¼šä»£ç 
- é…ç½®æ–‡ä»¶æˆªå›¾
- test_config.pyæµ‹è¯•ç»“æœ
- logs/app_error.logé”™è¯¯æ—¥å¿—
- å®Œæ•´çš„é”™è¯¯æç¤ºä¿¡æ¯

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.2  
**æœ€åæ›´æ–°**: 2025-12-09  
**ç»´æŠ¤è€…**: ç³»ç»Ÿå¼€å‘å›¢é˜Ÿ
